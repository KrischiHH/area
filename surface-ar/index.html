<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Surface AR – Native (Scene Viewer / Quick Look)</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{margin:0;height:100%;background:#111;color:#e8eefc;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{display:grid;place-items:center;min-height:100vh;padding:16px}
    model-viewer{width:min(100%,820px);height:80vh;border-radius:16px;overflow:hidden;background:#000}
    button[slot="ar-button"]{padding:.8rem 1.2rem;border-radius:12px;border:1px solid rgba(255,255,255,.25);background:#222;color:#fff}
    #err{position:fixed;left:12px;top:12px;background:#b00020;padding:8px 10px;border-radius:8px;display:none;font:12px/1.35 monospace}
    .tip{position:fixed;left:12px;bottom:12px;opacity:.85;font:14px/1.4 system-ui}
  </style>
</head>
<body>
  <div id="err"></div>

  <div class="wrap">
    <model-viewer id="mv"
      src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
      ar ar-modes="scene-viewer quick-look webxr"
      camera-controls autoplay exposure="1" shadow-intensity="1"
      environment-image="https://modelviewer.dev/shared-assets/environments/neutral.hdr"
      interpolation-decay="200"
      camera-orbit="0deg 65deg 2.5m"     <!-- angenehmere Perspektive -->
      field-of-view="35deg"
      camera-target="0m 1m 0m"           <!-- zentriert auf ~1m Höhe -->
      poster="">
      <button slot="ar-button">In AR öffnen</button>
    </model-viewer>
  </div>

  <div class="tip">
    <b>Tipp:</b> Auf Android öffnet sich „Scene Viewer“, auf iOS „Quick Look“.  
  </div>

<script>
  const qs = new URLSearchParams(location.search);
  const sceneUrl = qs.get('scene');
  const showErr = (m)=>{ const el=document.getElementById('err'); el.textContent=m; el.style.display='block'; };

  let cfg = { 
    model:{ url:"https://modelviewer.dev/shared-assets/models/Astronaut.glb", usdzUrl:null },
    target:{ previewUrl:null }
  };

  (async ()=>{
    if (sceneUrl){
      try{
        const r = await fetch(sceneUrl, {cache:'no-cache'}); if(!r.ok) throw new Error(r.status+' '+r.statusText);
        const j = await r.json();
        if (j.model)  cfg.model  = Object.assign(cfg.model,  j.model);
        if (j.target) cfg.target = Object.assign(cfg.target, j.target);
      }catch(e){ showErr('scene.json konnte nicht geladen werden: '+e.message); }
    }
    const mv = document.getElementById('mv');
    mv.src = cfg.model.url || mv.src;
    if (cfg.model.usdzUrl){ mv.setAttribute('ios-src', cfg.model.usdzUrl); } else { mv.removeAttribute('ios-src'); }
    // Optional: Poster aus Target-Preview (schöne Lade-Ansicht)
    if (cfg.target?.previewUrl){ mv.setAttribute('poster', cfg.target.previewUrl); }
  })();
</script>
</body>
</html>
